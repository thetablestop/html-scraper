if: tag IS blank
language: node_js
node_js:
- 12
env:
  matrix:
  - VERSION_PREFIX=1.0
  global:
  - secure: mT88BuB8qdUjsWCZAzK7UREnj1/zCCzeZJMlJtiWFxAZ8Hh9s08GpPCi9OEFJT6fb333KEWq35JEt49jWf8fGUC2dByfedE6jC8pSGsiCzJFfFBcrwfIaiSOX7gh7fp/KrvH2gzbgiMHrrwlOf+mubpyTE1E4TwVfBgwvyNmpZYRvQhIgS99paKxx5Qn/wqK9lMqmRo18dLHaVrTEYdk6hv/1Uu9M+jM9LGUW/H6yg1pIEy2aZveNS3ToFT6I1I2pRToWl6a2uVuR+/TcvNG51PW3f2oKiX/fFBbVx1MtG8t9r7fYxK0kB0+wyX+80vdCWtLNEtPB5oOG5NffGt0dNTpWlRpJCFXtv+7Cu91XgSf6JEE3DTcaWGqJU32Gj8053As8docizxd62tjPs7EYNdQwxRgLv0oICXh2zN3oZTh9/JWpdSp1urQ1KhjejD2886vy2kPhUO6C/BAT9yspIAKws84lH4pqJivJaRFNlGbh3lh4TaTbzdwLk5DAZ3sXDwTLKLnkvUBXyCTUi2NqCql9z+kxp/v/VMZVpOaDPFs3fiPCVXJtIq5ZsaCGFPkXIYNoikMH+YEG4xMWd/GdmlJR7M6Vy/eqizhvaBjG1CqiFsMzntK14EoHYdmJHuW/dNSODgHGEcicREngN4k0HLd6OevnTiptLLCOWv4Ij8=
  - secure: Uw60yP+srL2jW5XANIwlGBkas5i/0GZAVcz2lbhi81aOZtJMufi6eSdO2+9zkwkTrjjyJQgvfatUTCo5W/ZXU6gtsFZvDFh/DBTdABmNpEjP4t5w5nZJs8VHRD6SFnA0htcpIALuFiXBQJ7flHNheyfHhKg2yndTl+0cpAZ0W7fwXkT1ByZB1ZD6ifCuOdOZkxyvacxQFdRamvwVeowYyYcZodx9cQcd7I9qZeDTjAmjv2Pkx2v8M2wAFxomFgqHfMnUoqb8OektBrvbnwTpe2ju6rSQBCsJr/L2c9pkD1hOseV7B3yiyJlJk4Id3crEegSJbAmDZP6tETXnAX52BIhFn9PI51uOfOhUNAlGTBFzn41BVfkeykno3HdHdgXSQztXiGcqCpn40PRSqjPx890FgJk2YyZ7ZsgsmgKYbfChrMn0MIEhCEtfUPYUDcO5s4xqf1RHspR57QpiLequqLkbZSnBL7CGvkyAQ2DzQOjzAI8gDLCNa5RkAqojzfcY4F0+EABJk/HuRstEd9nDARWOnAiVcLn4bd9NfmZJFaRtA3Tlsa66jglnlDLjDQNrtAzNCaM9LoK1uyjNhpohllV2GzktCHTLLSCX/JwzluIT9CV3e5OlVSJdx3LXVr9EVbTqIiIRJANmy1AvqenvYkwLw17K4HAtGEqqhdOjn5U=
  - secure: oYUJUEoF7fCHvye6c/x65y6b1UKshgdsRYtXAukUSUudEBlwdv7O6htbImueGC13bLjdSTNg37A7YZ75Pf+eEvLXtDhP4+3ltgh/Zlf8WV+cJkA02gBRk7j2TG6Bkn+j7qT4HxGnSzRIvwfGtnU2hd1zcix7lFbt51+fTuqmJq9jsxUX+FidnGAcLULnlB5+TcVQZkeP8/h7K9ceYja8u9twfu3OSxDv93EsJQuE4E54Vr98qp/SOIKQEC5Po95DO4mfRMVxhG1+qRiBjDukUk0wQDVwl3W0K/iQjnpvH6Zq1eKwNOLVrfaJaKSJRz1TsZ/FUiRQfQ27eiQwnxh9q5MtGGXPNpVNWTBmjIMFxsuz7QA7PJhHRQD9kIRlSdqvDa/jn7ut/0aLZwFcTbip3/sL1/sOAYqXaH3V8dbWUzG6HtVnUk8x7NTEg36ARZ2rKmbWp9zsnLL85ZeE0ysInWMXi76AIHRRjOUMr80J1t2UeHxOEKJY1MHEysDfIhaz0miA0dQNZ8962pybLpN4cVgNJ9k4qML+A1IIw3j7BuWKmc4YkzezHNkYLpI/mMfevtaIk4uPyeSUAc/JFmK6fAhWtnoelqVOdcWS8mRH2udz0FcY9upduLpBPh4uNtoV8L1S2bDZshTi+b2n+/CyQB/KwRmGwvovQcRfPwsgsLU=
  - secure: UgSPB5zY9jLr0oI4hcxNhsvFNS49NuFOOhO44nFC6Q7/EcACzIDwe4LlvYRt94B/tliAf4XuBFuYThLCC8RWCHGfZo6ut602g0w/2z7t7Vgu2cuYGskIUCMkETaW6qYr8T9GxUt5MW8xHlXlS2R6fvxS/OFH4SahmkUIcDoQX/i7uJAD+QyJ6usK7E+zSY+pD8StHbFit/t9U2futxqOk8BLfcEkFcQ5i55xI4AdKi4gtRQ6KBaM0+14WyJm3luB8aC6afzkYgsGKkWSShStMu6IQRYWP3sTcWBEYKYyP5gjYzZWEb+iH1Ax2taM9G9uDlyYL1DiSSfeDVb6AHOeg+/2qRo9XzJHbkp8oeM39guR6SYYyeBEZXKsDNa0suY6K8cO3q5xcBe80adYBlF/vjUkY+mURcvGZbKncnMJNANKPQoZ6mv0DmyHfXvztbNK5Z+cOrzD/7eZVxDcX/aWChLXyki5HyWxQu3TSkQ0ndNrvbsrLBHs0LXWdBfpviKOtQ8QLPA4F69js4r/O+sGV9RlJ2ZGi/96A78SCloG0YHVQwL+OoMWUWniLHZvTLaqaDCwZqI1bSB5WrnfEdG59n/mkvw2pPElHCRbtxfwto+8dGREydHT5ZrzdsaACUG3gRZrWqLSc71fFMdnovROlOiKWAbhLFWrqSdG7apNNPI=
notifications:
  slack:
    secure: Fh9QdTOD+NlrqSZ/Io87Mw39cXeD3vufas3XhZkhMkgDL3G6WsHiY3QvubB8WNSWwzem2yI9NfDIxJvnizt+NhngWOTwE+lewrXAMu+n2FsVXOF3/bN10Gfr1YReLizVvBn1zyMJ4yOwNXOcwQ2/N3hXEBTTWcPfT8JV2euFXuBBAgcLKdZB97agp5qevXmm6zS/CpB0qae268t+mZiKetOWPE8xlTFqgjmKHIJLs8uGrac4p+GeKXoPIhVMP/Hzb09GOOa6B1GYTcP6I5P8O0P4SpWb2zp7Bpxw7FH16yy2GLihxGZQN3PIHjldZS/uwYhJbOXq31ZQvpcIKdJn30JhSYjdDmOKMUUm+xkOyRBdn6ZgsDqCTYjyaUtQeBxvz37xMcImhyPGGJRtyy07NDMC7EPjCEQHqcWQTXFpwiixrLMJWXker+J6UrlaxxL4WiF8f8jGCIfALyBarnbOWZV8nFBoasI5HC56s5vqFx82NwOzAQTla8XwrMFMVssRrdDALkXKbiu3weAkwF/v83PXgaZSIaBV0fEunJJP8/HZVfSQUdf+we2z5Jppq2+U7s0TI2iAyfWNxYlnA1+gMqzf+n+L/6toDkkbJpbOh9QroNQtLyK7gQB4c5RbVcYBC66oiocqg9/xBxOiwZz4FoFEFoAgmVGy9ZlIZDyAV/g=
services:
- docker
jobs:
  include:
    - node_js: 12
    - stage: deploy
      if: (NOT type IN (pull_request)) AND (branch = master)
      script:
      - export FULL_VERSION=$VERSION_PREFIX.$TRAVIS_BUILD_NUMBER
      - export REPO_TAGGED=$TRAVIS_REPO_SLUG:$FULL_VERSION
      - export REPO_LATEST=$TRAVIS_REPO_SLUG:latest
      - echo "$DOCKER_TOKEN" | docker login -u "$DOCKER_USERNAME" --password-stdin
      - docker build -t $REPO_TAGGED .
      - docker tag $REPO_TAGGED $REPO_LATEST
      - docker push $REPO_TAGGED
      - docker push $REPO_LATEST
      - git config --global user.email "builds@travis-ci.com"
      - git config --global user.name "Travis CI"
      - git remote add tagorigin https://$GH_USERNAME:$GH_TOKEN@github.com/$TRAVIS_REPO_SLUG.git
      - git tag $FULL_VERSION -a -m "Generated tag from TravisCI for build $TRAVIS_BUILD_NUMBER"
      - git push tagorigin --tags
